import{j as a}from"./CQBR0ly3.js";import{i as u}from"./BdCIxj-1.js";import"./gnU0ypJ3.js";var d={};const m=new u.PrismaClient;async function p(t,r,i=!1){try{const{token:s}=t.cookies;if(!s)return r.status(401).json({message:"Not authenticated"}),null;let n;try{n=a.verify(s,d.JWT_SECRET||"development-secret-key")}catch(o){return console.error("Error verifying token:",o.message),r.status(401).json({message:"Invalid or expired token"})}const e=await m.user.findUnique({where:{id:n.id}});return e?i&&!e.isAdmin?(r.status(403).json({message:"Admin privileges required"}),null):(t.user={id:e.id,email:e.email,firstName:e.firstName,lastName:e.lastName,isAdmin:e.isAdmin},t.user):(r.status(404).json({message:"User not found"}),null)}catch(s){return console.error("Auth middleware error:",s),r.status(500).json({message:"Internal server error"}),null}}export{p as authMiddleware};
