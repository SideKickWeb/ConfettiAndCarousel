import{_ as A}from"./CtFe8zgF.js";import{u as B}from"./BY4aLptK.js";import{r as m,g as C,c as o,a as t,q as V,d as p,b as f,w,t as r,F as h,s as _,o as a,n as E,p as x}from"./DPqVHIb4.js";const D={class:"max-w-6xl mx-auto p-6"},F={key:0,class:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-6"},S={key:1},N={key:0,class:"text-center py-10"},T={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"},$={key:2,class:"text-center py-10 bg-gray-50 rounded-lg"},L={key:3,class:"space-y-6"},P={class:"p-4 bg-gray-50 border-b flex flex-col md:flex-row justify-between md:items-center"},j={class:"flex items-center gap-3"},q={class:"text-xl font-semibold"},z={class:"text-sm text-gray-500"},M={class:"mt-2 md:mt-0 flex gap-2"},O=["onClick"],U={class:"p-4"},G={class:"mb-4"},Q={class:"text-gray-600"},Y={class:"text-sm text-gray-500 mt-1"},H={key:0},J={class:"border rounded-md overflow-hidden"},K={class:"min-w-full divide-y divide-gray-200"},R={class:"bg-white divide-y divide-gray-200"},W={class:"px-3 py-3 whitespace-nowrap"},X={class:"text-sm font-medium text-gray-900"},Z={class:"px-3 py-3"},I={class:"text-sm text-gray-500"},tt={key:0},et={key:1},st={class:"list-disc list-inside ml-2"},ot={class:"px-3 py-3 whitespace-nowrap text-right"},at={class:"text-sm text-gray-900"},rt={class:"px-3 py-3 whitespace-nowrap text-right"},nt={class:"text-sm text-gray-900"},it={class:"bg-gray-50"},dt={class:"px-3 py-2 text-right text-sm font-medium text-gray-900"},lt={class:"mt-4 text-xs text-gray-500"},yt={__name:"my-bookings",setup(ct){const l=B(),c=m([]),y=m(!1),u=m(null);C(()=>{l.isAuthenticated&&v()});const b=n=>n.reduce((e,d)=>e+d.product.price*d.quantity,0),v=async()=>{if(l.isAuthenticated){y.value=!0,u.value=null;try{const n=await fetch("/api/bookings/user",{headers:{Authorization:`Bearer ${l.token}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Failed to fetch bookings")}c.value=await n.json()}catch(n){console.error("Error fetching bookings:",n),u.value=n.message||"An unexpected error occurred"}finally{y.value=!1}}},k=async n=>{if(confirm("Are you sure you want to cancel this booking?"))try{const e=await fetch(`/api/bookings/${n}/cancel`,{method:"POST",headers:{Authorization:`Bearer ${l.token}`}});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to cancel booking")}const d=c.value.find(s=>s.id===n);d&&(d.status="cancelled")}catch(e){console.error("Error cancelling booking:",e),alert(e.message||"An unexpected error occurred")}};return(n,e)=>{const d=A;return a(),o("div",D,[e[11]||(e[11]=t("div",{class:"my-8 text-center"},[t("h1",{class:"text-4xl font-bold mb-2"},"My Bookings"),t("p",{class:"text-lg text-gray-600"},"View and manage your event bookings")],-1)),V(l).isAuthenticated?(a(),o("div",S,[y.value?(a(),o("div",N,e[3]||(e[3]=[t("p",{class:"text-gray-600"},"Loading your bookings...",-1)]))):u.value?(a(),o("div",T,[t("p",null,r(u.value),1),t("button",{onClick:v,class:"mt-2 text-sm underline"},"Try Again")])):c.value.length===0?(a(),o("div",$,[e[5]||(e[5]=t("p",{class:"text-gray-600 mb-4"},"You don't have any bookings yet.",-1)),f(d,{to:"/booking",class:"px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded"},{default:w(()=>e[4]||(e[4]=[p(" Book an Event ")])),_:1})])):(a(),o("div",L,[(a(!0),o(h,null,_(c.value,s=>(a(),o("div",{key:s.id,class:"bg-white rounded-lg shadow-md overflow-hidden"},[t("div",P,[t("div",null,[t("div",j,[t("h3",q,r(s.eventType)+" Event",1),t("span",{class:E(["px-2 py-1 text-xs font-medium rounded-full",s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="confirmed"?"bg-green-100 text-green-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"])},r(s.status.charAt(0).toUpperCase()+s.status.slice(1)),3)]),t("p",z,r(new Date(s.eventDate).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),1)]),t("div",M,[s.status==="pending"?(a(),o("span",{key:0,onClick:i=>k(s.id),class:"text-sm text-red-500 hover:text-red-700 cursor-pointer"}," Cancel ",8,O)):x("",!0)])]),t("div",U,[t("div",G,[e[6]||(e[6]=t("h4",{class:"font-medium text-gray-700 mb-1"},"Event Details",-1)),t("p",Q,r(s.description||"No description provided"),1),t("p",Y,"Guests: "+r(s.guests),1)]),s.items&&s.items.length>0?(a(),o("div",H,[e[10]||(e[10]=t("h4",{class:"font-medium text-gray-700 mb-2"},"Ordered Products",-1)),t("div",J,[t("table",K,[e[9]||(e[9]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Product "),t("th",{scope:"col",class:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Details "),t("th",{scope:"col",class:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Quantity "),t("th",{scope:"col",class:"px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Price ")])],-1)),t("tbody",R,[(a(!0),o(h,null,_(s.items,i=>(a(),o("tr",{key:i.id},[t("td",W,[t("div",X,r(i.product.name),1)]),t("td",Z,[t("div",I,[i.variant?(a(),o("p",tt,"Variant: "+r(i.variant.name),1)):x("",!0),i.customValues&&i.customValues.length?(a(),o("div",et,[e[7]||(e[7]=t("p",{class:"text-xs mt-1"},"Customizations:",-1)),t("ul",st,[(a(!0),o(h,null,_(i.customValues,g=>(a(),o("li",{key:g.id,class:"text-xs"},r(g.option.name)+": "+r(g.value),1))),128))])])):x("",!0)])]),t("td",ot,[t("div",at,r(i.quantity),1)]),t("td",rt,[t("div",nt,"$"+r((i.product.price*i.quantity).toFixed(2)),1)])]))),128))]),t("tfoot",it,[t("tr",null,[e[8]||(e[8]=t("td",{colspan:"3",class:"px-3 py-2 text-right text-sm font-medium text-gray-500"}," Total ",-1)),t("td",dt," $"+r(s.total?s.total.toFixed(2):b(s.items).toFixed(2)),1)])])])])])):x("",!0),t("div",lt,[t("p",null,"Booking created: "+r(new Date(s.createdAt).toLocaleString()),1)])])]))),128))]))])):(a(),o("div",F,[t("p",null,[e[1]||(e[1]=p("Please ")),f(d,{to:"/login",class:"underline font-bold"},{default:w(()=>e[0]||(e[0]=[p("sign in")])),_:1}),e[2]||(e[2]=p(" to view your bookings."))])]))])}}};export{yt as default};
