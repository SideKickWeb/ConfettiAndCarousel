import{_ as te,a as oe}from"./BvGU_pER.js";import{_ as se}from"./CtFe8zgF.js";import{B as ne,_ as ae,r as y,j as O,g as ie,c as n,b as N,a as e,p as x,q as b,d as h,w as M,v as le,y as k,C as F,m as Y,z as q,t as l,n as j,F as _,s as w,D as re,E as ue,A as de,o as a}from"./DPqVHIb4.js";import{u as ce}from"./BY4aLptK.js";import{u as ve}from"./CB8XxEi3.js";const pe=ne("booking",{state:()=>({bookings:[],currentBooking:null,loading:!1,error:null}),getters:{getUserBookings:g=>g.bookings},actions:{async createBooking(g){this.loading=!0,this.error=null;try{const v=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!v.ok){const p=await v.json();return this.error=p.message||"Failed to create booking",null}const u=await v.json();return this.bookings.unshift(u),u}catch(v){return console.error("Error creating booking:",v),this.error="An unexpected error occurred",null}finally{this.loading=!1}},async fetchUserBookings(){this.loading=!0,this.error=null;try{const g=await fetch("/api/bookings/user");if(!g.ok){const v=await g.json();this.error=v.message||"Failed to fetch bookings";return}this.bookings=await g.json()}catch(g){console.error("Error fetching user bookings:",g),this.error="An unexpected error occurred"}finally{this.loading=!1}},async cancelBooking(g){this.loading=!0,this.error=null;try{const v=await fetch(`/api/bookings/${g}/cancel`,{method:"POST"});if(!v.ok){const p=await v.json();return this.error=p.message||"Failed to cancel booking",!1}const u=this.bookings.findIndex(p=>p.id===g);return u!==-1&&(this.bookings[u].status="CANCELLED"),!0}catch(v){return console.error("Error cancelling booking:",v),this.error="An unexpected error occurred",!1}finally{this.loading=!1}}}}),me={class:"page-wrapper"},ge={class:"content"},ye={class:"booking-content"},fe={key:0,class:"success-message"},ke={key:1,class:"info-message"},be={class:"form-section"},he={class:"form-grid"},_e={class:"form-group"},we={class:"form-group"},Ce=["min"],Ve={class:"form-group"},xe={class:"form-group"},Te={class:"form-section"},qe={key:0,class:"loading-container"},Se={key:1,class:"error-message"},Ae={key:2,class:"product-selection"},Ne={class:"category-filters"},Pe=["onClick"],Be={class:"product-grid"},Ee={class:"product-image"},Ie=["src","alt"],De={key:1,class:"no-image"},Ue={class:"product-info"},$e={class:"product-header"},Oe={class:"price"},Fe={class:"description"},je={class:"product-actions"},ze=["onClick"],Le={class:"product-count"},Me={class:"selected-products-list"},Ye={class:"product-details"},Qe={class:"product-options"},Re={key:0},Ge={key:1},Je={class:"options-list"},We={class:"product-controls"},He={class:"quantity-control"},Ke=["onClick"],Xe={class:"quantity"},Ze=["onClick"],et={class:"price-controls"},tt={class:"total-price"},ot=["onClick"],st={class:"booking-total"},nt={class:"form-actions"},at={class:"acknowledgment-wrapper"},it={class:"checkbox-container"},lt=["disabled"],rt={key:0},ut={key:1},dt={key:0,class:"modal-overlay"},ct={class:"modal-container"},vt={class:"modal-header"},pt={class:"modal-content"},mt={key:0,class:"form-group"},gt={class:"select-wrapper"},yt=["value"],ft={key:1},kt=["onUpdate:modelValue","placeholder"],bt=["onUpdate:modelValue"],ht=["value"],_t=["onUpdate:modelValue"],wt={class:"option-description"},Ct={class:"toast-container"},Vt={__name:"booking",setup(g){const v=ce(),u=ve();pe(),de();const p=y({eventType:"",eventDate:"",description:"",guests:1}),i=y([]),C=y(null),c=y(null),P=y(null),f=y({}),B=y(1),E=y(null),S=y([]),A=y(!1),I=y(!1),D=y(!1),Q=O(()=>new Date().toISOString().split("T")[0]),R=O(()=>C.value?u.products.filter(s=>s.categoryId===C.value||s.category===C.value):u.products),G=O(()=>i.value.reduce((s,t)=>{const r=Number(t.product.price||0);return s+r*(t.quantity||1)},0));ie(async()=>{await u.fetchCategories(),await u.fetchProducts(),console.log("Categories loaded in booking page:",u.categories)});const J=()=>{p.value={eventType:"",eventDate:"",description:"",guests:1},i.value=[],I.value=!1},W=s=>{if(!s.customizable&&(!s.variants||s.variants.length===0)){const t=i.value.findIndex(r=>r.product.id===s.id&&!r.variant);if(t>=0)i.value[t].quantity++,i.value[t].isNewlyAdded=!0,setTimeout(()=>{i.value[t]&&(i.value[t].isNewlyAdded=!1)},1500),U(`${s.name} quantity increased to ${i.value[t].quantity}`);else{i.value.push({product:s,quantity:1,customValues:[],isNewlyAdded:!0});const r=i.value.length-1;setTimeout(()=>{i.value[r]&&(i.value[r].isNewlyAdded=!1)},1500),U(`${s.name} added to your booking`)}z()}else c.value=s,P.value=s.variants&&s.variants.length?s.variants[0]:null,f.value={},B.value=1},H=()=>{if(!c.value)return;const s=[];if(c.value.customizable&&c.value.customOptions)for(const r of c.value.customOptions){const m=f.value[r.id];m&&s.push({optionId:r.id,optionName:r.name,value:m})}i.value.push({product:c.value,variant:P.value,quantity:B.value,customValues:s,isNewlyAdded:!0});const t=i.value.length-1;setTimeout(()=>{i.value[t]&&(i.value[t].isNewlyAdded=!1)},1500),U(`${c.value.name} added to your booking`),$(),z()},U=s=>{const t={message:s};S.value.push(t),setTimeout(()=>{const r=S.value.indexOf(t);r!==-1&&S.value.splice(r,1)},3e3)},z=()=>{E.value&&ue(()=>{E.value.scrollIntoView({behavior:"smooth"})})},$=()=>{c.value=null,P.value=null,f.value={},B.value=1},K=s=>{i.value.splice(s,1)},X=s=>{i.value[s].quantity++},Z=s=>{i.value[s].quantity>1&&i.value[s].quantity--},ee=async()=>{if(v.isAuthenticated){A.value=!0;try{const s=i.value.map(m=>{var V;return{productId:m.product.id,variantId:((V=m.variant)==null?void 0:V.id)||null,quantity:m.quantity,customValues:m.customValues.map(o=>({optionId:o.optionId,value:o.value}))}}),t=i.value.reduce((m,V)=>{const o=V.product.price;return m+o*V.quantity},0),r=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v.token}`},body:JSON.stringify({...p.value,total:t,items:s})});if(!r.ok){const m=await r.json();throw new Error(m.message||"Failed to submit booking")}I.value=!0}catch(s){console.error("Error submitting booking:",s),alert(s.message||"An unexpected error occurred")}finally{A.value=!1}}},L=s=>s==null?"0.00":Number(s).toFixed(2);return(s,t)=>{const r=te,m=se,V=oe;return a(),n("div",me,[N(r),e("div",ge,[t[28]||(t[28]=e("div",{class:"booking-header"},[e("div",{class:"header-content"},[e("h1",null,"Book Your Event"),e("p",null,"Tell us about your event, and we'll make it special!")])],-1)),e("div",ye,[I.value?(a(),n("div",fe,[t[8]||(t[8]=e("p",null,"Thank you for your booking request! We'll contact you soon to confirm the details.",-1)),e("button",{onClick:J,class:"primary-button"}," Book Another Event ")])):b(v).isAuthenticated?(a(),n("form",{key:2,onSubmit:le(ee,["prevent"]),class:"booking-form"},[e("div",be,[t[19]||(t[19]=e("h2",null,"Event Details",-1)),e("div",he,[e("div",_e,[t[15]||(t[15]=e("label",{for:"eventType"},"Event Type",-1)),k(e("select",{id:"eventType","onUpdate:modelValue":t[0]||(t[0]=o=>p.value.eventType=o),required:""},t[14]||(t[14]=[Y('<option value="" disabled data-v-2fc8ce47>Select event type</option><option value="birthday" data-v-2fc8ce47>Birthday Party</option><option value="wedding" data-v-2fc8ce47>Wedding</option><option value="corporate" data-v-2fc8ce47>Corporate Event</option><option value="babyShower" data-v-2fc8ce47>Baby Shower</option><option value="graduation" data-v-2fc8ce47>Graduation</option><option value="other" data-v-2fc8ce47>Other</option>',7)]),512),[[F,p.value.eventType]])]),e("div",we,[t[16]||(t[16]=e("label",{for:"eventDate"},"Event Date",-1)),k(e("input",{type:"date",id:"eventDate","onUpdate:modelValue":t[1]||(t[1]=o=>p.value.eventDate=o),min:Q.value,required:""},null,8,Ce),[[q,p.value.eventDate]])]),e("div",Ve,[t[17]||(t[17]=e("label",{for:"guests"},"Expected Number of Guests",-1)),k(e("input",{type:"number",id:"guests","onUpdate:modelValue":t[2]||(t[2]=o=>p.value.guests=o),min:"1",required:""},null,512),[[q,p.value.guests]])]),e("div",xe,[t[18]||(t[18]=e("label",{for:"description"},"Event Description",-1)),k(e("textarea",{id:"description","onUpdate:modelValue":t[3]||(t[3]=o=>p.value.description=o),rows:"3",placeholder:"Tell us more about your event..."},null,512),[[q,p.value.description]])])])]),e("div",Te,[t[24]||(t[24]=e("h2",null,"Select Products",-1)),b(u).loading?(a(),n("div",qe,t[20]||(t[20]=[e("span",{class:"loading-spinner"},null,-1),e("p",null,"Loading products...",-1)]))):b(u).error?(a(),n("div",Se,[e("p",null,l(b(u).error),1),e("button",{onClick:t[4]||(t[4]=(...o)=>b(u).clearError&&b(u).clearError(...o)),class:"text-link"},"Try Again")])):(a(),n("div",Ae,[e("div",Ne,[e("button",{type:"button",onClick:t[5]||(t[5]=o=>C.value=null),class:j(["filter-btn",C.value===null?"active":""])}," All Products ",2),(a(!0),n(_,null,w(b(u).categories,o=>(a(),n("button",{key:o.value,type:"button",onClick:d=>C.value=o.value,class:j(["filter-btn",C.value===o.value?"active":""])},l(o.label||"Category"),11,Pe))),128))]),e("div",Be,[(a(!0),n(_,null,w(R.value,o=>(a(),n("div",{key:o.id,class:"product-card"},[e("div",Ee,[o.image?(a(),n("img",{key:0,src:o.image,alt:o.name},null,8,Ie)):(a(),n("div",De,t[21]||(t[21]=[e("span",null,"No image available",-1)])))]),e("div",Ue,[e("div",$e,[e("h3",null,l(o.name),1),e("span",Oe,"£"+l(L(o.price)),1)]),e("p",Fe,l(o.description),1),e("div",je,[e("button",{type:"button",onClick:d=>W(o),class:"book-button"}," Add to Booking ",8,ze)])])]))),128))])])),i.value.length>0?(a(),n("div",{key:3,class:"selected-products",ref_key:"selectedProductsSection",ref:E},[e("h3",null,[t[22]||(t[22]=h("Your Selected Products ")),e("span",Le,l(i.value.length),1)]),e("div",Me,[(a(!0),n(_,null,w(i.value,(o,d)=>(a(),n("div",{key:d,class:j(["selected-product-item",{"highlight-animation":o.isNewlyAdded}])},[e("div",Ye,[e("h4",null,l(o.product.name),1),e("div",Qe,[o.variant?(a(),n("p",Re,"Variant: "+l(o.variant.name),1)):x("",!0),o.customValues&&o.customValues.length?(a(),n("div",Ge,[t[23]||(t[23]=e("p",{class:"options-title"},"Customizations:",-1)),e("ul",Je,[(a(!0),n(_,null,w(o.customValues,T=>(a(),n("li",{key:T.optionId},l(T.optionName)+": "+l(T.value),1))),128))])])):x("",!0)])]),e("div",We,[e("div",He,[e("button",{type:"button",onClick:T=>Z(d),class:"quantity-btn"},"-",8,Ke),e("span",Xe,l(o.quantity),1),e("button",{type:"button",onClick:T=>X(d),class:"quantity-btn"},"+",8,Ze)]),e("div",et,[e("div",tt,"£"+l((o.quantity*o.product.price).toFixed(2)),1),e("button",{type:"button",onClick:T=>K(d),class:"remove-btn"}," Remove ",8,ot)])])],2))),128)),e("div",st,[e("p",null,"Total: £"+l(G.value.toFixed(2)),1)])])],512)):x("",!0)]),e("div",nt,[t[27]||(t[27]=Y('<div class="disclaimer-box" data-v-2fc8ce47><h4 data-v-2fc8ce47>Important Information</h4><ul data-v-2fc8ce47><li data-v-2fc8ce47><strong data-v-2fc8ce47>Prices shown are not final.</strong> Additional admin fees or service charges may apply based on your specific requirements.</li><li data-v-2fc8ce47><strong data-v-2fc8ce47>Date selection is not guaranteed.</strong> Your requested date will be reviewed for availability.</li><li data-v-2fc8ce47><strong data-v-2fc8ce47>Confirmation process:</strong> After submitting this request, our team will review your details, confirm availability, and contact you for payment.</li><li data-v-2fc8ce47><strong data-v-2fc8ce47>Your booking is only guaranteed</strong> after payment is received and confirmed by our team.</li></ul></div>',1)),e("div",at,[e("label",it,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=o=>D.value=o),required:""},null,512),[[re,D.value]]),t[25]||(t[25]=e("span",{class:"checkmark"},null,-1)),t[26]||(t[26]=e("span",{class:"acknowledgment-text"},[h("I have read and acknowledge the "),e("strong",null,"important information"),h(" above regarding pricing, date availability, confirmation process, and that my booking is only guaranteed after payment is received and confirmed.")],-1))])]),e("button",{type:"submit",class:"submit-button",disabled:A.value||b(u).loading||i.value.length===0||!D.value},[A.value?(a(),n("span",rt,"Submitting...")):(a(),n("span",ut,"Submit Booking Request"))],8,lt)])],32)):(a(),n("div",ke,[e("p",null,[t[11]||(t[11]=h("Please ")),N(m,{to:"/login",class:"link"},{default:M(()=>t[9]||(t[9]=[h("sign in")])),_:1}),t[12]||(t[12]=h(" or ")),N(m,{to:"/register",class:"link"},{default:M(()=>t[10]||(t[10]=[h("create an account")])),_:1}),t[13]||(t[13]=h(" to book an event."))])]))])]),c.value?(a(),n("div",dt,[e("div",ct,[e("div",vt,[e("h3",null,"Customize "+l(c.value.name),1),e("button",{onClick:$,class:"close-button"},"×")]),e("div",pt,[c.value.variants&&c.value.variants.length>0?(a(),n("div",mt,[t[29]||(t[29]=e("label",null,"Variant",-1)),e("div",gt,[k(e("select",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.selectedVariant=o)},[(a(!0),n(_,null,w(c.value.variants,o=>(a(),n("option",{key:o.id,value:o},l(o.name)+" "+l(o.price?`(+£${L(o.price)})`:""),9,yt))),128))],512),[[F,s.selectedVariant]])])])):x("",!0),c.value.customizable&&c.value.customOptions&&c.value.customOptions.length>0?(a(),n("div",ft,[(a(!0),n(_,null,w(c.value.customOptions,o=>(a(),n("div",{key:o.id,class:"form-group"},[e("label",null,l(o.name),1),o.type==="text"?k((a(),n("input",{key:0,type:"text","onUpdate:modelValue":d=>f.value[o.id]=d,placeholder:o.description},null,8,kt)),[[q,f.value[o.id]]]):o.type==="select"?k((a(),n("select",{key:1,"onUpdate:modelValue":d=>f.value[o.id]=d},[t[30]||(t[30]=e("option",{value:"",disabled:""},"Choose an option",-1)),(a(!0),n(_,null,w(o.choices?o.choices.split(","):[],d=>(a(),n("option",{key:d,value:d.trim()},l(d.trim()),9,ht))),128))],8,bt)),[[F,f.value[o.id]]]):o.type==="color"?k((a(),n("input",{key:2,type:"color","onUpdate:modelValue":d=>f.value[o.id]=d,class:"color-picker"},null,8,_t)),[[q,f.value[o.id]]]):x("",!0),e("p",wt,l(o.description),1)]))),128))])):x("",!0)]),e("div",{class:"modal-footer"},[e("button",{onClick:$,class:"cancel-button"},"Cancel"),e("button",{onClick:H,class:"confirm-button"},"Add to Booking")])])])):x("",!0),e("div",Ct,[(a(!0),n(_,null,w(S.value,(o,d)=>(a(),n("div",{key:d,class:"toast"},[t[31]||(t[31]=e("span",{class:"toast-icon"},"✓",-1)),e("span",null,l(o.message),1)]))),128))]),N(V)])}}},Nt=ae(Vt,[["__scopeId","data-v-2fc8ce47"]]);export{Nt as default};
