import{u as $,_ as P,a as Q}from"./BvGU_pER.js";import{_ as R}from"./CtFe8zgF.js";import{u as I}from"./BY4aLptK.js";import{u as D}from"./CB8XxEi3.js";import{_ as H,r as d,j as O,g as U,c as e,b as h,a as t,p as u,t as c,w as C,F as x,s as F,U as Y,A as z,o as a,d as N}from"./DPqVHIb4.js";const G={class:"page-wrapper"},J={class:"content product-detail-page"},K={key:0,class:"loading-container"},W={key:1,class:"error-container"},X={key:2,class:"product-container"},Z={class:"product-header"},tt={class:"product-details"},ot={class:"product-image"},st=["src","alt"],et={key:1,class:"no-image"},at={class:"product-info"},nt={key:0,class:"product-category"},it={class:"product-price"},rt={key:1,class:"product-description"},ct={class:"quantity-selector"},lt={class:"quantity-controls"},dt=["disabled"],ut={class:"quantity"},pt={class:"product-actions"},_t={key:0,class:"related-products"},vt={class:"related-products-grid"},ht=["onClick"],mt={class:"related-product-image"},gt=["src","alt"],kt={key:1,class:"no-image-small"},yt={class:"related-product-info"},ft={class:"related-product-price"},bt={class:"toast-container"},wt={__name:"[id]",setup(Ct){const q=Y(),m=z(),T=I();D();const g=$(),s=d(null),k=d(!0),p=d(null),l=d(1),_=d([]),v=d([]),y=O(()=>T.isAuthenticated),B=async()=>{try{const n=await fetch("/api/products");if(!n.ok)throw new Error("Failed to fetch related products");const o=await n.json();v.value=(o.data||o).filter(i=>i.id!==s.value.id).slice(0,4)}catch(n){console.error("Error fetching related products:",n),v.value=[]}},A=async()=>{k.value=!0,p.value=null;try{const n=q.params.id,o=await fetch(`/api/products/${n}`);if(!o.ok)throw new Error("Failed to fetch product");const i=await o.json();s.value=i.data||i,await B()}catch(n){console.error("Error fetching product:",n),p.value="Failed to load product details"}finally{k.value=!1}},S=()=>{if(!y.value){m.push("/login");return}m.push({path:"/booking",query:{product:s.value.id,quantity:l.value}})},E=()=>{s.value&&(g.addToCart(s.value,l.value),M(`${s.value.name} added to your cart`))},L=()=>{l.value++},j=()=>{l.value>1&&l.value--},f=n=>parseFloat(n||0).toFixed(2),M=n=>{const o={message:n};_.value.push(o),setTimeout(()=>{const i=_.value.indexOf(o);i!==-1&&_.value.splice(i,1)},3e3)};return U(()=>{A(),g.loadFromLocalStorage()}),(n,o)=>{const i=P,b=R,V=Q;return a(),e("div",G,[h(i),t("main",J,[n.isLoading?(a(),e("div",K,o[0]||(o[0]=[t("span",{class:"loading-spinner"},null,-1),t("p",null,"Loading product details...",-1)]))):p.value?(a(),e("div",W,[o[2]||(o[2]=t("h2",null,"Product Not Found",-1)),t("p",null,c(p.value),1),h(b,{to:"/products",class:"back-link"},{default:C(()=>o[1]||(o[1]=[N("Back to Products")])),_:1})])):s.value?(a(),e("div",X,[t("div",Z,[h(b,{to:"/products",class:"back-link"},{default:C(()=>o[3]||(o[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),N(" Back to Products ")])),_:1})]),t("div",tt,[t("div",ot,[s.value.image?(a(),e("img",{key:0,src:s.value.image,alt:s.value.name},null,8,st)):(a(),e("div",et,"No image available"))]),t("div",at,[t("h1",null,c(s.value.name),1),s.value.categoryName?(a(),e("p",nt,c(s.value.categoryName),1)):u("",!0),t("div",it," £"+c(f(s.value.price)),1),s.value.description?(a(),e("div",rt,[t("p",null,c(s.value.description),1)])):u("",!0),t("div",ct,[o[4]||(o[4]=t("label",{for:"quantity"},"Quantity:",-1)),t("div",lt,[t("button",{type:"button",onClick:j,class:"quantity-btn",disabled:l.value<=1},"-",8,dt),t("span",ut,c(l.value),1),t("button",{type:"button",onClick:L,class:"quantity-btn"},"+")])]),t("div",pt,[y.value?(a(),e("button",{key:0,onClick:S,class:"booking-btn"}," Add to Event Booking ")):u("",!0),t("button",{onClick:E,class:"cart-btn"}," Add to Cart ")])])]),v.value.length>0?(a(),e("div",_t,[o[5]||(o[5]=t("h2",null,"You May Also Like",-1)),t("div",vt,[(a(!0),e(x,null,F(v.value,r=>(a(),e("div",{key:r.id,class:"related-product-card",onClick:w=>n.navigateToProduct(r.id)},[t("div",mt,[r.image?(a(),e("img",{key:0,src:r.image,alt:r.name},null,8,gt)):(a(),e("div",kt))]),t("div",yt,[t("h4",null,c(r.name),1),t("span",ft,"£"+c(f(r.price)),1)])],8,ht))),128))])])):u("",!0)])):u("",!0)]),t("div",bt,[(a(!0),e(x,null,F(_.value,(r,w)=>(a(),e("div",{key:w,class:"toast"},[o[6]||(o[6]=t("span",{class:"toast-icon"},"✓",-1)),t("span",null,c(r.message),1)]))),128))]),h(V)])}}},Bt=H(wt,[["__scopeId","data-v-43178297"]]);export{Bt as default};
